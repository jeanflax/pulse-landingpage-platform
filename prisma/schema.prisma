generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

model Client {
  id            String    @id @default(cuid())
  name          String
  shopifyDomain String?
  shopifyToken  String?
  brandVoice    String?
  logoUrl       String?
  primaryColor  String?   @default("#000000")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  projects      Project[]
  products      Product[]
}

model Project {
  id          String    @id @default(cuid())
  clientId    String
  client      Client    @relation(fields: [clientId], references: [id], onDelete: Cascade)
  name        String
  slug        String    @unique
  status      String    @default("DRAFT")
  templateId  String?
  template    Template? @relation(fields: [templateId], references: [id])
  content     String    @default("{}")
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  variants    Variant[]
}

model Variant {
  id            String      @id @default(cuid())
  projectId     String
  project       Project     @relation(fields: [projectId], references: [id], onDelete: Cascade)
  trafficSource String      @default("DEFAULT")
  content       String      @default("{}")
  isActive      Boolean     @default(true)
  createdAt     DateTime    @default(now())
  analytics     Analytics[]
}

model Template {
  id          String    @id @default(cuid())
  name        String
  type        String    @default("LANDING_PAGE")
  category    String?
  description String?
  thumbnail   String?
  sections    String    @default("[]")
  isPublic    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  projects    Project[]
}

model Product {
  id           String   @id @default(cuid())
  clientId     String
  client       Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  shopifyId    String
  title        String
  description  String?
  price        Float
  comparePrice Float?
  images       String   @default("[]")
  variants     String?
  syncedAt     DateTime @default(now())

  @@unique([clientId, shopifyId])
}

model Analytics {
  id          String   @id @default(cuid())
  variantId   String
  variant     Variant  @relation(fields: [variantId], references: [id], onDelete: Cascade)
  views       Int      @default(0)
  clicks      Int      @default(0)
  conversions Int      @default(0)
  date        DateTime @default(now())
}
